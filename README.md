# [Тестовое задание](https://gist.github.com/softzilla/92d282063f5f55393a2a8352f17792ce)
## Попробовать
**Запустите `go run ./main.go [-N <N - макс. количество задач исполняемых за раз, по дефолту 10>]`**

Для новой задачи эндпоинт `POST :3000/tasks`, принимающий все параметры от query string

`GET :3000/tasks` возвращает все задачи в JSON-формате, отсортированные по статусу (сначала выполненные, а затем по ID)

Однако для удобства тестирования есть `./index.html`, его просто открыть в браузере, он не подается с сервера. (Порт 3000 захардкоден)

Там еще есть прикольная кнопка "Randomize", которая поставит случайные значения параметров и отправит их.

Сервер устойчив к неверным параметрам и выдает ошибку.

## Имплементация
Он использует mutex-ы вместо каких-нибудь синхронизирующих каналов, потому что по моему мнению так намного проще, хотя и просто ошибиться (и допустим забыть разлочить мютекс), но все же.  
А именно mutex-ов два, один отвечает за очередь и список выполняемых задач (потому что их и так почти всегда меняют вместе), а второй за список выполненных задач, ждущих когда закончится TTL.

Для выполненных и выполняемых задач код использует map-ы, поэтому у задач есть ID, для очереди один slice. ID только растут.

## API
Если всё-таки REST, то у него должна быть подробная документация :)

### `POST /tasks`
Создает новую задачу и ставит в очередь.

Аргументы:
- `n: int` - Количество итераций, целочисленное
- `n1: float` - Значение первой итерации
- `d: float` - Разница между значениями итераций
- `I: float` - Интервал между итерациями в секундах
- `TTL: float` - Насколько задача сохраняется в памяти после завершения

Если `n` не целочисленное, возвращает ошибку  
Если `n` <= `0`, задача выполнится моментально  
Если `I` или `TTL` < 1, это рассматривается как нулевой интервал или TTL

Возвращает объект:
- `success: boolean` - Успешно ли создана задача
- `error?: string` - Если `success == false`, текст ошибки

### `GET /tasks`
Возвращает список объектов задач

Возвращает:
- Массив объектов:
	- `ID: int` - ID задачи
	- `Status: int` - Статус задачи
		- `0` - В очереди
		- `1` - Исполняется
		- `2` - Завершена
	- `MaxIterations: int` - Количество итераций (n)
	- `Delta: float` - Разница между значениями итераций (d)
	- `CurrentValue: float` - Значение настоящей итерации
	- `StartValue: float` - Значение первой итерации (n1)
	- `Iteration: int` - Порядковый номер итерации
	- `Interval: float` - Интервал между итерациями в секундах (I)
	- `TTL: float` - Time-to-live задачи
	- `QueueNumber: int` - Номер задачи в очереди, если она в очереди, иначе `-1`
	- `EnqueuedAt: int` - Когда задача была поставлена в очередь (unix секунды)
	- `StartedAt: int` - Когда задача была начата (unix секунды, если задача не в очереди, иначе `0`)
	- `CompletedAt: int` - Когда задача была завершена (unix секунды, если она была завершена, иначе `0`)